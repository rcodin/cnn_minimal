refactored code from cnn_code
